<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Siecia University - Music Dept.</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  </head>
<body>
  <div class="container-fluid">
    <div class="row">

<!-- Column 1: Genre/Folder Dropdown -->
     <div class="col-3 song-list">

<!--Genre Dropdown-->
      <label for="genreSelect">Genre</label>
<select id="genreSelect" class="form-select form-select-sm mb-2">
  {% for g in genres %}
    <option value="{{ g }}" {% if g == genre %}selected{% endif %}>{{ g }}</option>
  {% endfor %}
</select>


<!-- available_songs_list -->
<div id="asl">
  {% include 'available_song_list.html' %}
</div>
</div><!--Close column1-->

<!-- Column 2: Video and Queue -->
     <div class="col-4 video-section">

<!-- ##### VIDEO SCREEN #### -->
     <video id="player">
        <source id="video-source" src="{{ url_for('static', filename=current_song['filename']) if current_song else '' }}" type="video/mp4">
           Your browser does not support the video tag.
      </video>

<!-- #### QUEUE #### -->
<div id="queue" class="p-2 bg-dark text-white">
  {% include 'queue.html' %}
</div>



 <!-- #### PLAYER BUTTONS #### -->
      <div class="mt-2 text-center" id="media_controls">
           <button class="btn btn-warning btn-sm" onclick="previousSong()">Previous</button>
           <button class="btn btn-success btn-sm" onclick="togglePlayPause()" id="playPauseBtn">‚ñ∂ Play</button>
           <button class="btn btn-success btn-sm" onclick="stopPlayback()">‚èπ Stop</button>
           <button class="btn btn-warning btn-sm" onclick="restartSong()">üîÅ Start Over</button>
           <button class="btn btn-warning btn-sm" onclick="nextSong()">Next</button>
           <label><input type="checkbox" id="autoplay-toggle">Auto</label>
          <label><input type="checkbox" id="random-toggle">Rand</label>
          <button class="btn btn-danger mb-1" onclick="clearQueue()">üßπ C</button>
      </div>


         <!--DEBUGGER-->
   <div class="container mt-3 text-white">
    {% for key, value in session_data.items() %}
     <details class="mb-2">
       <summary style="cursor:pointer; font-weight:bold;">{{ key }}</summary>
       <pre style="white-space: pre-wrap; word-wrap: break-word;">{{ value | tojson(indent=2) }}</pre>
    </details>
   {% endfor %}
  </div> <!--DEBUGGER-->



</div> <!--Close column2-->

<!-- Columns 3: Song Sheet -->
     <div class="col-5 sheet-section">
        <img src="{{ url_for('static', filename='') }}" id="sheet-display" alt="Song Sheet">
      </div> <!--Close column3-->

    </div> <!--Close class="row"-->
  </div> <!-- class="container-fluid" -->

<script>
// Needs to stay here for Python template rendering
const songs = {{ songs|tojson|safe }};

 function clearQueue() {
      fetch('/clear_queue', { method: 'POST' })
        .then(() => location.reload());
    }

      const autoplay = document.getElementById("autoplay-toggle").checked;

if (data.was_empty && data.video && data.sheet) {
  source.src = data.video;
  player.load();
  document.getElementById("sheet-display").src = data.sheet;

  if (autoplay) {
    player.play();
  }
}



</script>
<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>